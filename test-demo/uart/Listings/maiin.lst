C51 COMPILER V9.56.0.0   MAIIN                                                             10/25/2019 13:00:29 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIIN
OBJECT MODULE PLACED IN .\Objects\maiin.obj
COMPILER INVOKED BY: C:\Keil_v5_c51\C51\BIN\C51.EXE maiin.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\maiin.lst) TABS(2) OBJECT(.\Objects\maiin.obj)

line level    source

   1          /*---------------------------------------------------------------------*/
   2          /* --- STC MCU Limited ------------------------------------------------*/
   3          /* --- STC15F4K60S4 ÏµÁÐ ´®¿Ú1µØÖ·×Ô¶¯Ê¶±ð¾ÙÀý¾ÙÀý---------------------*/
   4          /* --- Mobile: (86)13922805190 ----------------------------------------*/
   5          /* --- Fax: 86-0513-55012956,55012947,55012969 ------------------------*/
   6          /* --- Tel: 86-0513-55012928,55012929,55012966-------------------------*/
   7          /* --- Web: www.STCMCU.com --------------------------------------------*/
   8          /* --- Web: www.GXWMCU.com --------------------------------------------*/
   9          /* Èç¹ûÒªÔÚ³ÌÐòÖÐÊ¹ÓÃ´Ë´úÂë,ÇëÔÚ³ÌÐòÖÐ×¢Ã÷Ê¹ÓÃÁËSTCµÄ×ÊÁÏ¼°³ÌÐò        */
  10          /* Èç¹ûÒªÔÚÎÄÕÂÖÐÓ¦ÓÃ´Ë´úÂë,ÇëÔÚÎÄÕÂÖÐ×¢Ã÷Ê¹ÓÃÁËSTCµÄ×ÊÁÏ¼°³ÌÐò        */
  11          /*---------------------------------------------------------------------*/
  12          
  13          //±¾Ê¾ÀýÔÚKeil¿ª·¢»·¾³ÏÂÇëÑ¡ÔñIntelµÄ8058Ð¾Æ¬ÐÍºÅ½øÐÐ±àÒë
  14          //ÈôÎÞÌØ±ðËµÃ÷,¹¤×÷ÆµÂÊÒ»°ãÎª11.0592MHz
  15          
  16          
  17          #include "reg51.h"
  18          #include "intrins.h"
  19          
  20          typedef unsigned char BYTE;
  21          typedef unsigned int WORD;
  22          
  23          //-----------------------------------------------
  24          
  25          #define     SLAVE   1               //¶¨Òå´Ó»ú±àºÅ,0Îª´Ó»ú1, 1Îª´Ó»ú2
  26          
  27          #if SLAVE == 0
              #define     SAMASK  0x33            //´Ó»ú1µØÖ·ÆÁ±ÎÎ»
              #define     SERADR  0x55            //´Ó»ú1µÄµØÖ·Îªxx01,xx01
              #define     ACKTST  0x78            //´Ó»ú1Ó¦´ð²âÊÔÊý¾Ý
              #else
  32          #define     SAMASK  0x3C            //´Ó»ú2µØÖ·ÆÁ±ÎÎ»
  33          #define     SERADR  0x5A            //´Ó»ú2µÄµØÖ·Îªxx01,10xx
  34          #define     ACKTST  0x49            //´Ó»ú2Ó¦´ð²âÊÔÊý¾Ý
  35          #endif
  36          
  37          #define     URMD    2               //0:Ê¹ÓÃ¶¨Ê±Æ÷2×÷Îª²¨ÌØÂÊ·¢ÉúÆ÷
  38                                              //1:Ê¹ÓÃ¶¨Ê±Æ÷1µÄÄ£Ê½0(16Î»×Ô¶¯ÖØÔØÄ£Ê½)×÷Îª²¨ÌØÂÊ·¢ÉúÆ÷
  39                                              //2:Ê¹ÓÃ¶¨Ê±Æ÷1µÄÄ£Ê½2(8Î»×Ô¶¯ÖØÔØÄ£Ê½)×÷Îª²¨ÌØÂÊ·¢ÉúÆ÷
  40          
  41          sfr T2H   =   0xd6;                 //¶¨Ê±Æ÷2¸ß8Î»
  42          sfr T2L   =   0xd7;                 //¶¨Ê±Æ÷2µÍ8Î»
  43          
  44          sfr P0M1 = 0x93;
  45          sfr P0M0 = 0x94;
  46          sfr P1M1 = 0x91;
  47          sfr P1M0 = 0x92;
  48          sfr P2M1 = 0x95;
  49          sfr P2M0 = 0x96;
  50          sfr P3M1 = 0xb1;
  51          sfr P3M0 = 0xb2;
  52          sfr P4M1 = 0xb3;
  53          sfr P4M0 = 0xb4;
  54          sfr P5M1 = 0xC9;
C51 COMPILER V9.56.0.0   MAIIN                                                             10/25/2019 13:00:29 PAGE 2   

  55          sfr P5M0 = 0xCA;
  56          sfr P6M1 = 0xCB;
  57          sfr P6M0 = 0xCC;
  58          sfr P7M1 = 0xE1;
  59          sfr P7M0 = 0xE2;
  60          
  61          sfr AUXR  =   0x8e;                 //¸¨Öú¼Ä´æÆ÷                              
  62          
  63          sfr SADDR =   0xA9;                 //´Ó»úµØÖ·¼Ä´æÆ÷
  64          sfr SADEN =   0xB9;                 //´Ó»úµØÖ·ÆÁ±Î¼Ä´æÆ÷
  65          
  66          void InitUart();
  67          
  68          char count;
  69          
  70          void main()
  71          {
  72   1          P0M0 = 0x00;
  73   1          P0M1 = 0x00;
  74   1          P1M0 = 0x00;
  75   1          P1M1 = 0x00;
  76   1          P2M0 = 0x00;
  77   1          P2M1 = 0x00;
  78   1          P3M0 = 0x00;
  79   1          P3M1 = 0x00;
  80   1          P4M0 = 0x00;
  81   1          P4M1 = 0x00;
  82   1          P5M0 = 0x00;
  83   1          P5M1 = 0x00;
  84   1          P6M0 = 0x00;
  85   1          P6M1 = 0x00;
  86   1          P7M0 = 0x00;
  87   1          P7M1 = 0x00;
  88   1      
  89   1          InitUart();                     //³õÊ¼»¯´®¿Ú
  90   1          ES = 1;
  91   1          EA = 1;
  92   1          while (1);
  93   1      }
  94          
  95          /*----------------------------
  96          UART ÖÐ¶Ï·þÎñ³ÌÐò
  97          -----------------------------*/
  98          void Uart() interrupt 4 using 1
  99          {
 100   1          if (TI)
 101   1          {
 102   2              TI = 0;                     //Çå³ýTIÎ»
 103   2              if (count != 0)
 104   2              {
 105   3                  count--;
 106   3                  SBUF = ACKTST;          //¼ÌÐø·¢ËÍÓ¦´ðÊý¾Ý
 107   3              }
 108   2              else
 109   2              {
 110   3                  SM2 = 1;                //Èô·¢ËÍÍê³É,ÔòÖØÐÂ¿ªÊ¼µØÖ·¼ì²â
 111   3              }
 112   2          }
 113   1          if (RI)
 114   1          {
 115   2              RI = 0;                     //Çå³ýRIÎ»
 116   2              SM2 = 0;                    //±¾»ú±»Ñ¡ÖÐºó,½øÈëÊý¾Ý½ÓÊÕ×´Ì¬
C51 COMPILER V9.56.0.0   MAIIN                                                             10/25/2019 13:00:29 PAGE 3   

 117   2              count = 7;
 118   2              SBUF = ACKTST;              //²¢¿ª·¢ËÍÓ¦´ðÊý¾Ý
 119   2          }
 120   1      }
 121          
 122          /*----------------------------
 123          ³õÊ¼»¯´®¿Ú
 124          ----------------------------*/
 125          void InitUart()
 126          {
 127   1          SADDR = SERADR;
 128   1          SADEN = SAMASK;
 129   1          SCON = 0xf8;                //ÉèÖÃ´®¿ÚÎª9Î»¿É±ä²¨ÌØÂÊ,Ê¹ÄÜ¶à»úÍ¨Ñ¶¼ì²â,(½«TB8ÉèÖÃÎª1,·½±ãÓëPCÖ±½ÓÍ¨Ñ¶²
             -âÊÔ)
 130   1      #if URMD == 0
                  T2L = 0xd8;                 //ÉèÖÃ²¨ÌØÂÊÖØ×°Öµ
                  T2H = 0xff;                 //115200 bps(65536-18432000/4/115200)
                  AUXR = 0x14;                //T2Îª1TÄ£Ê½, ²¢Æô¶¯¶¨Ê±Æ÷2
                  AUXR |= 0x01;               //Ñ¡Ôñ¶¨Ê±Æ÷2Îª´®¿Ú1µÄ²¨ÌØÂÊ·¢ÉúÆ÷
              #elif URMD == 1
                  AUXR = 0x40;                //¶¨Ê±Æ÷1Îª1TÄ£Ê½
                  TMOD = 0x00;                //¶¨Ê±Æ÷1ÎªÄ£Ê½0(16Î»×Ô¶¯ÖØÔØ)
                  TL1 = 0xd8;                 //ÉèÖÃ²¨ÌØÂÊÖØ×°Öµ
                  TH1 = 0xff;                 //115200 bps(65536-18432000/4/115200)
                  TR1 = 1;                    //¶¨Ê±Æ÷1¿ªÊ¼Æô¶¯
              #else
 142   1          TMOD = 0x20;                //ÉèÖÃ¶¨Ê±Æ÷1Îª8Î»×Ô¶¯ÖØ×°ÔØÄ£Ê½
 143   1          AUXR = 0x40;                //¶¨Ê±Æ÷1Îª1TÄ£Ê½
 144   1          TH1 = TL1 = 0xfb;           //115200 bps(256 - 18432000/32/115200)
 145   1          TR1 = 1;
 146   1      #endif
 147   1      }
 148          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    102    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
